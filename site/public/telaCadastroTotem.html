<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitority - Cadastro Funcionario</title>

  <link rel="stylesheet" href="./css/telaCadastroTotem.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css">
  <link rel="icon" href="./assets/imgs/sobreNos.png">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.all.min.js"></script>
  <!-- <script src="./js/funcao.js"></script> -->
  <script src="./js/perfil-validacao.js"></script>

</head>

<body onload="buscarDadoTotem()">
  <main>
    <!-- Div que contem a parte de navegação (parte verde do menu)-->
    <div class="navegacao">
      <ul class="navbar-nav">
        <li class="nav-item">
          <!-- Foto De Perfil do USUARIO e o NOME do mesmo -->
          <div class="fotoDePerfil">
            <a href="#" class="nav-link">
              <!-- imagem do ICONE DA FOTO DE PERFIL-->
              <span class="icone"><i class="uil uil-user"></i> </span>
              <span class="titulo"><span id="b_usuario">usuário</span></span>
            </a>
          </div>
        <li class="nav-item">
          <a href="dashboard-tecnico.html" class="nav-link">
            <!-- Imagem do ICONE DO planos-->
            <span class="icone"> <i class="uil  uil-chart-line"></i> </span>
            <span class="titulo"> Dashboard </span>
          </a>
        </li>
        <!-- <li onclick="Adicionar()" id="adicionar2">
                        <a href="#">
    
                            -Imagem do ICONE DE ADICIONAR 
                            <span class="icone"> <i class="uil uil-plus"></i> </span>
                            <span class="titulo"> Adicionar</span>
                            <span class="icone2"><i class="uil uil-angle-down"></i></span>
    
                        </a>
                    </li> -->
        <!-- <div class="adicionar" id="adicionar3"> -->
        <li class="nav-item">
          <a href="./telaCadastroEstabelecimento.html" class="nav-link">
            <!--Imagem do ICONE DE ADICIONAR -->
            <span class="icone"> <i class="uil uil-estate"></i> </span>
            <span class="titulo"> Estabelecimento</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="./telaCadastroTotem.html" class="nav-link">
            <!--Imagem do ICONE DE ADICIONAR -->
            <span class="icone"> <i class="uil uil-server-connection"></i> </span>
            <span class="titulo"> Cadastrar Totem</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="./telaCadastroFunc.html" class="nav-link">
            <!--Imagem do ICONE DE ADICIONAR -->
            <span class="icone"> <i class="uil uil-user-plus"></i> </span>
            <span class="titulo"> Funcionario</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="./lista.html" class="nav-link">
            <!--Imagem do ICONE DE ADICIONAR -->
            <span class="icone"> <i class="uil uil-bell"></i> </span>
            <span class="titulo"> Notificações</span>
          </a>
        </li>
        <!-- </div> -->
        <li class="nav-item">
          <a href="configuracoes.html" class="nav-link">
            <!-- Imagem do ICONE DE CONFIGURAÇÕES -->
            <span class="icone"><i class="uil uil-cog"></i></span>
            <span class="titulo"> Configurações</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://chamadosgrupo9.auvo.com.br/Login#signin" class="nav-link">
            <!-- Imagem do ICONE DE SUPORTE -->
            <span class="icone"><i class="uil uil-comment-question"></i>
            </span>
            <span class="titulo"> Suporte</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="./index.html" class="nav-link">
            <!-- Botão de Sair  -->
            <span class="icone"><i class="uil uil-signout"></i> </span>
            <span class="titulo"> Home </span>
          </a>
        </li>
      </ul>
    </div>
    <!-- Right Panel -->
    <div id="right-panel" class="right-panel">
      <div class="animated fadeIn">
        <div id="container-global" class="container-all">
          <!-- REGISTRO DO totem -->
          <div class="titulo-2 funcionarios">
            <h3>Cadastre seus totem</h3>
            <p>Por favor, insira os dados do totem que você deseja cadastrar</p>
          </div>
          <hr>
          <div class="container-pai">
            <div class="container-filho">
              <div class="estilo-box">
                <p>Modelo</p>
                <input class="input-empresa" id="inputNomeTotem" placeholder="Ex: TOTEM 65" required
                  onblur="validarNomeTotem()" />
              </div>
              <div class="estilo-box">
                <p>Processador</p>
                <input class="input-empresa" id="inputProcessador" placeholder="Ex: I5 " type="text"
                  onblur="validarProcessador()" required />
              </div>
              <div class="estilo-box">
                <p>Placa Mãe</p>
                <input class="input-empresa" type="text" placeholder="Ex: B450M" id="inputPlacaMae"
                  onblur="validarPlacaMae()" />
              </div>
              <div class="estilo-box">
                <p>Ram</p>
                <input class="input-empresa" id="inputRam" placeholder="Ex: 8" required onblur="validarRam()" />
              </div>
            </div>
            <div class="container-filho-2">

              <div class="estilo-box">
                <p>Armazenamento</p>
                <input class="input-empresa" id="inputArmazenamento" placeholder="Ex: 250" required
                  onblur="validarArmazenamento()" />
              </div>
              <div class="estilo-box">
                <p>Sistema Operacional</p>
                <select class="input-empresa" name="select" id="inputSo" required onblur="validarFuncao()">
                  <option value="">Selecione um SO</option>
                  <option value="Linux">Linux</option>
                  <option value="Windows">Windows</option>
                  <option value="Android">Android</option>
                  <option value="Mac">Mac</option>
                </select>
              </div>
              <div class="estilo-box">
                <p>Estabelecimento</p>
                <select class="input-empresa" id="inputEstabelecimento">
                  <option value="">Selecione um Estabelecimento</option>
                </select>
              </div>
            </div>
          </div>
          <button class="botao-registro" onclick="cadastrarTotem()">
            CADASTRAR
          </button>
          <hr />
          <div id="tabela_funcionarios" class="tabela-funcionarios">
            <h3>TOTEM</h3>
          </div>
        </div>
        <!-- /.content -->
      </div>
    </div>
    <!-- /#right-panel -->
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>

    <!-- Start of securithelp Zendesk Widget script -->
    <script id="ze-snippet"
      src="https://static.zdassets.com/ekr/snippet.js?key=2f1c47af-6ca3-4ce8-9188-958944ef0eb5"> </script>
    <!-- End of securithelp Zendesk Widget script -->
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.all.min.js"></script>


<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
  window.onload = buscarDadoEstabelecimento;

  var sessionIdEmpresa = sessionStorage.ID_EMPRESA;
  var sessionFkEmpresa = sessionStorage.FK_EMPRESA;
  var idEmpresa = 0;

function buscarDadoEstabelecimento() {

  
  if (sessionIdEmpresa > 0) {
    idEmpresa = sessionIdEmpresa;
  } else if (sessionFkEmpresa > 0) {
    idEmpresa = sessionFkEmpresa;
  } else {
    console.log("id e fk empresa estão errados");
  }
  
  fetch(`/totem/listarEstabelecimentos/${idEmpresa}`)
    .then(resposta => resposta.json())
    .then(function (estabelecimentos) {
      console.log('estou na listarEstabelecimentos para a combo box', estabelecimentos);
      if (estabelecimentos.length === 0) {
        var tabelaFuncionarios = document.getElementById("tabela_funcionarios");
        var mensagem = document.createElement("span");
        mensagem.classList.add('mensagem');
        mensagem.innerHTML = "Nenhum resultado encontrado.";
        tabelaFuncionarios.appendChild(mensagem);
        throw "Nenhum resultado encontrado!!";
      }

      console.log("Dados recebidos!!!!!: ", JSON.stringify(estabelecimentos));
      var comboEstabelecimento = document.getElementById("inputEstabelecimento");

      for (var i = 0; i < estabelecimentos.length; i++) {
        var option = document.createElement('option');
        option.value = estabelecimentos[i].idEstabelecimento; // Substitua 'id_estabelecimento' pelo nome da coluna que contém o valor da opção
        option.text = estabelecimentos[i].nome; // Substitua 'nome' pelo nome da coluna que contém o texto da opção
        comboEstabelecimento.appendChild(option);
      }
    })
    .catch(function (erro) {
      console.log(erro);
    });
    buscarDadoTotem();
}

  
  
  function cadastrarTotem() {
    var fkEstabelecimento = inputEstabelecimento.value
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var modeloVar = inputNomeTotem.value;
    var processadorVar = inputProcessador.value;
    var placaMaeVar = inputPlacaMae.value;
    var ramVar = inputRam.value;
    var armazenamentoVar = inputArmazenamento.value;
    var soVar = inputSo.value;


    fetch(`/totem/cadastrarTotem`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/funcionario.js
        fkEstabelecimento: fkEstabelecimento,
        modeloServer: modeloVar,
        processadorServer: processadorVar,
        placaMaeServer: placaMaeVar,
        ramServer: ramVar,
        armazenamentoServer: armazenamentoVar,
        soServer: soVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          Swal.fire({
            icon: 'success',
            title: 'Parabéns',
            text: 'Cadastro realizado com sucesso!',
          })

          setTimeout(() => { window.location.reload(); }, 2000);
        } else {

          Swal.fire({
            icon: 'error',
            title: 'Ops...',
            text: 'Houve um erro ao tentar realizar o cadastro!',
          })
          console.log("respostaaaa: ", resposta);
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

  function buscarDadoTotem() {
    if (sessionIdEmpresa > 0) {
    idEmpresa = sessionIdEmpresa;
  } else if (sessionFkEmpresa > 0) {
    idEmpresa = sessionFkEmpresa;
  } else {
    console.log("id e fk empresa estão errados");
  }
    fetch(`/totem/listar/${idEmpresa}`)
      .then(function (resposta) {
        console.log('estou na buscarDadoTotem', resposta);
        if (resposta.ok) {
          if (resposta.status == 204) {
            var tabelaFuncionarios = document.getElementById("tabela_funcionarios");
            var mensagem = document.createElement("span");
            mensagem.classList.add('mensagem');
            mensagem.innerHTML = "Nenhum resultado encontrado.";
            tabelaFuncionarios.appendChild(mensagem);
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));

            var tabelaFuncionarios = document.getElementById("tabela_funcionarios");
            tabelaFuncionarios.innerHTML = "<h3>TOTEM</h3>";
            for (let i = 0; i < resposta.length; i++) {
              var publicacao = resposta[i];

              // criando e manipulando elementos do HTML via JavaScript

              tabelaFuncionarios.innerHTML += `
                        
              <div class="func" id="${i}">
                      <div class="estilo-atributos">
                        <h5>Modelo:</h5>
                        <p>${publicacao.modelo}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Processador:</h5>
                        <p>${publicacao.processadorModelo}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Placa Mâe:</h5>
                        <p>${publicacao.placaMaeModelo}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Ram:</h5>
                        <p>${publicacao.ramModelo}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Armazenamento:</h5>
                        <p>${publicacao.armazenamentoModelo}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>SO:</h5>
                        <p>${publicacao.sistemaOperacional}</p>
                      </div>
                      <div class="estilo-atributos">
                        <h5>Estabelecimento:</h5>
                        <p>${publicacao.nome}</p>
                      </div>
                      <button class="removerCard" onclick="removerCard(${publicacao.idTotem})">Remover</button>
                  </div>
                    `;
            }
          });
        } else {
          throw console.log('Estou na buscarDadosTotem()', JSON.stringify(resposta));
        }
      })
      .catch(function (resposta) {
        console.log(resposta);
      });
  }


</script>